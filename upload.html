<body>
  <input type="file" id="fileInput" multiple>
  <button class="btn" onclick="uploadFiles()">Carica</button>
  <div id="progressContainer"></div>
  <a href="gallery.html" class="pulsante">Galleria</a>
</body>
<style>
  body {
    background-color: #F7EAEC;
    font-family: "Brush Script MT", cursive;
    text-align: center;
  }

  .btn {
    background: black;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 50px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 20px;
    transition: opacity 0.3s;
  }

  .btn:hover {
    opacity: 0.8;
  }

  #progressContainer {
    margin-top: 20px;
    width: 80%;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  .progressWrapper {
    margin-bottom: 15px;
    text-align: left;
  }

  .progressLabel {
    font-size: 14px;
    color: #FF4CAA;
    margin-bottom: 5px;
  }

  .progressBar {
    width: 100%;
    height: 14px;
    background: #eee;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
  }

  .progressBar div {
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, #FF4CAA, #FF85D0);
    transition: width 0.3s ease;
  }
</style>

<script>
function uploadFiles() {
  const input = document.getElementById('fileInput');
  const container = document.getElementById('progressContainer');
  container.innerHTML = ""; // pulisce le barre precedenti

  const files = input.files;
  if (files.length === 0) {
    alert("Seleziona almeno una foto.");
    return;
  }

  const progressElements = [];
  for (const file of files) {
    const wrapper = document.createElement("div");
    wrapper.className = "progressWrapper";

    const label = document.createElement("div");
    label.className = "progressLabel";
    label.textContent = "Caricamento: " + file.name;

    const bar = document.createElement("div");
    bar.className = "progressBar";

    const progress = document.createElement("div");
    bar.appendChild(progress);

    wrapper.appendChild(label);
    wrapper.appendChild(bar);
    container.appendChild(wrapper);

    progressElements.push({file, progress, label});
  }

  const formData = new FormData();
  for (const f of files) {
    formData.append("foto", f);
  }

  const xhr = new XMLHttpRequest();
  xhr.open("POST", "https://matrimoniome.appspot.com/upload", true);

  xhr.upload.addEventListener("progress", (e) => {
    if (e.lengthComputable) {
      const percent = (e.loaded / e.total) * 100;
      progressElements.forEach(pe => pe.progress.style.width = percent + "%");
    }
  });

  xhr.onload = () => {
    if (xhr.status === 200) {
      const response = JSON.parse(xhr.responseText);
      response.files.forEach(f => {
        const pe = progressElements.find(p => p.file.name === f.filename);
        if (pe) pe.label.textContent = "✅ Caricato: " + f.filename;
      });
    } else {
      progressElements.forEach(pe => pe.label.textContent = "❌ Errore: " + pe.file.name);
    }
  };

  xhr.onerror = () => {
    progressElements.forEach(pe => pe.label.textContent = "❌ Errore connessione: " + pe.file.name);
  };

  xhr.send(formData);
}
</script>
